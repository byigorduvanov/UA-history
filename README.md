# Аналіз точок сходження історичного спреду

FastAPI додаток для аналізу історичних даних спреду: знаходження точок сходження, визначення найчастішого значення спреду та візуалізація даних у вигляді інтерактивної діаграми.

## Встановлення

1. Встановіть залежності:
```bash
pip install -r requirements.txt
```

## Запуск

Запустіть сервер:
```bash
uvicorn main:app --reload
```

Сервер буде доступний за адресою: `http://localhost:8000`

## Використання

### Endpoint `/analyze`

Аналізує історичні дані спреду та знаходить точки сходження. Може повертати JSON або HTML з інтерактивною діаграмою.

**Параметри:**
- `url` (обов'язковий) - повний URL або slug для завантаження даних
- `limit` (опціональний, за замовчуванням 1500) - кількість точок для аналізу
- `tolerance` (опціональний, за замовчуванням 0.01) - толерантність для визначення сходження
- `format` (опціональний, за замовчуванням `json`) - формат відповіді: `json` або `html`

**Приклади:**

1. **Отримати JSON з результатами аналізу:**
```
http://localhost:8000/analyze?url=sqd-mexc-swap-gate-swap&limit=1500&tolerance=0.01
```
або явно вказати формат:
```
http://localhost:8000/analyze?url=sqd-mexc-swap-gate-swap&limit=1500&format=json
```

2. **Отримати інтерактивну діаграму (HTML):**
```
http://localhost:8000/analyze?url=sqd-mexc-swap-gate-swap&limit=1500&format=html
```

3. **З повним URL:**
```
http://localhost:8000/analyze?url=https://uainvest.com.ua/api/arbitrage/historical?slug=sqd-mexc-swap-gate-swap&limit=1500&format=html
```

**Результат:**
- **JSON формат** (`format=json` або без параметра):
  - Виводить результати в консоль сервера
  - Повертає JSON відповідь з результатами аналізу
  
- **HTML формат** (`format=html`):
  - Повертає HTML сторінку з інтерактивною діаграмою Plotly
  - Показує дві лінії: In (зелена) та Out (червона)
  - Відображає поточні значення та статус бірж
  - Дозволяє зум, наведення курсора та інші інтерактивні функції

### Візуалізація

Діаграма відображає:
- **Лінія In** (зелена) - значення `in_` з кожної точки спреду
- **Лінія Out** (червона) - значення `out` з кожної точки спреду
- **Поточні значення** - показуються у вигляді пунктирних ліній та окремих блоків
- **Статус бірж** - індикатори онлайн/офлайн статусу
- **Інтерактивність** - зум, панорама, наведення курсора для перегляду точних значень

## Структура проекту

```
UA-history/
├── main.py              # Точка входу FastAPI додатку
├── services/
│   └── spread_analyzer.py  # Логіка аналізу спреду та підготовка даних для графіка
├── models/
│   └── schemas.py       # Pydantic моделі для даних
├── templates/
│   └── chart.html       # HTML шаблон з інтерактивною діаграмою Plotly
├── requirements.txt     # Залежності
└── README.md           # Документація
```

## Алгоритм роботи

1. Завантажує історичні дані спреду з API
2. Знаходить точки сходження (де `abs(in - out) <= tolerance`)
3. Рахує найчастіше значення спреду в точках сходження
4. Виводить статистику в консоль
5. При `format=html`: підготовлює дані та рендерить інтерактивну діаграму

## Швидкий старт

1. **Встановіть залежності:**
```bash
pip install -r requirements.txt
```

2. **Запустіть сервер:**
```bash
uvicorn main:app --reload
```

3. **Відкрийте браузер та перейдіть за адресою:**
```
http://localhost:8000/analyze?url=sqd-mexc-swap-gate-swap&limit=1500&format=html
```

Ви побачите інтерактивну діаграму з історичними даними спреду!

